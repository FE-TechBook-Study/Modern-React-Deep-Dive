# 태진

### 서버 컴포넌트

- 서버 컴포넌트를 사용해야 할 때

  - 즉시 데이터를 가져올 경우

  - 백엔드 리소스에 직접 접근할 경우

  - .env에서 가져오는 API KEY 등 보안이 필요한 경우

  - onClick, useState 등 클라이언트 컴포넌트 사용이 불가피한 경우를 제외한 모든 경우

- 서버 사이드에서 랜더링 된다.

### 클라이언트 컴포넌트

- 클라이언트 컴포넌트를 사용해야 할 때

  - 상화작용 및 이벤트 리스너(onClick(), onChange())를 사용해야 하는 경우

  - 상태 및 생명주기 효과(useState(), useEffect())를 사용해야 하는 경우

  - 브라우저 전용 API(window, document)를 사용해야 하는 경우

- 서버에서 랜더링 되고, 클라이언트 사이드에서 한 번 더 렌더링 된다.

### Next.js의 렌더링

- 하이브리드 렌더링 방식을 사용하며 서버 사이드 렌더링과 클라이언트 사이드 렌더링의 장점을 결합한 형태의 렌더링 방식이다.

- 서버 사이드

  - 서버에서는 HTML, CSS, JavaScript 파일을 미리 생성하고 inline style, useState 초기값 선언 같은 서버 사이드에서 결정할 수 있는 CSS, Javascript 부분을 렌더링에 포함 시켜 HTML 형태로 결과물을 만든다. 이러한 기술을 프리렌더링이라고 하며, 프리렌더링 결과물은 나머지 CSS, Javascript와 함꼐 브라우저로 전송된다.

  - 이 과정에서 서버 컴포넌트와 클라이언트 컴포넌트 모두 렌더링되지만 서버 컴포넌트가 클라이언트 컴포넌트보다 먼저 렌더링 된다.

  - 클라이언트 컴포넌트가 렌더링 될 때 리액트의 상태 및 생명주기에 영향을 미치지 않는 useState의 초기값 선언은 프리렌더링 결과물에 포함되지만 setState, useEffect 처럼 상태 및 생명주기에 영향을 미치는 기능들은 포함되지 않는다.

    ```jsx
    // 클라이언트 컴포넌트
    'use client'

    const ClientComponent = () => {
      const [name, setName] = useState('김태진'); // 프리랜더링에 초기값 선언으로 포함됨

      useEffect(() => {
        setName('KIMTAEJIN')
      }, []) // 프리랜더링에 포함되지 않음

      return (
        <div className='text-base' style={{ display: 'flex'}}> // 프리렌더링에 inline style은 포함
          {name} // 초기값 '김태진'
        </div>
      )
    }

    export ClientComponent
    ```

    ```jsx
    // 프리렌더링 결과물
    <div class="text-base" style="display: flex;">
    	김태진
    </div>
    ```

- 클라이언트 사이드

  - 브라우저는 서버로부터 받은 HTML 형태의 프리렌더링 결과물을 먼저 로드하고, 이후 프리렌더링 결과물에 포함되지 않은 CSS와 JavaScript 파일들을 다운로드한다. 이 과정에서 프리렌더링 결과물을 미리 보여줌으로써 사용자 경험을 향상시킨다.

  - JavaScript 파일이 로드되면, 클라이언트 사이드에서 초기 렌더링이 시작된다. 프리렌더링 결과물에 포함되지 않았던 기능들을 이제 초기 렌더링 이후에 동작할 수 있도록 만들고, 클라이언트 컴포넌트들이 초기 렌더링되며 프리렌더링 결과물과의 차이점을 비교하고(render) 필요한 부분을 업데이트(commit)해서 초기 렌더링 결과물의 마크업을 프리렌더링 결과물의 마크업과 일치시킨다. 이 과정을 하이드레이션이라고 한다. 만약 업데이트(commit)된 초기 렌더링 결과물의 마크업이 프리렌더링 결과물의 마크업과 일치하지 않는다면 하이드레이션 오류가 발생한다.

  - 초기 렌더링이 끝난 후 부터는 onClick, useEffect 등 프리렌더링 결과물에서 제외됐던 기능을 사용할 수 있다. useEffect를 사용할 수 있는 시점 부터는 모두 클라이언트 사이드 렌더링이기 때문에 window, localStorage 등을 선언할 수 있다.

- 프리렌더링

  - 프리렌더링은 서버에서 웹페이지의 완성된 모습을 서버에서 미리 만들어 두는 기술이다. 이는 웹사이트의 로딩 시간을 줄이고, 사용자 경험을 향상시키기 위해 사용된다. 또한, 검색 엔진 최적화(SEO)에도 유리하며 크롤러가 콘텐츠를 더 잘 이해할 수 있게 돕는다.

- 하이드레이션

  - 하이드레이션은 클라이언트 사이드에서 프리렌더링 결과물을 받은 후, 이와 비교하여 클라이언트 컴포넌트를 초기 렌더링하는 과정이다. 이를 통해, 프리렌더링 결과물에서 제외된 기능들을 하이드레이션이 끝난 후 사용할 수 있게 된다. 이 과정에서 브라우저는 Diffing 알고리즘을 사용하여 프리랜더링 결과물과의 차이점을 비교하고 필요한 부분만 업데이트한다. 하이드레이션을 통한 초기 렌더링 결과물 마크업은 프리랜더링 결과물의 마크업과 일치해야한다.

- tailwind vs CSS-in-JS

  - tailwind는 클라이언트 사이드에서 정적 CSS파일로 제공되며 이 파일은 빌드 시점에 생성된다. 서버에서 전송받았기 때문에 클라이언트 사이드에서 따로 CSS 파일을 다운로드할 필요가 없다. 그래서 tailwind의 클래스가 선언된 프리렌더링 결과믈에 빠르게 스타일 정보를 입힐 수 있다.

  - CSS-in-Js인 Styled-component와 Emotion은 스타일을 동작으로 생성하고 컴포넌트의 상태에 따라 스타일을 변경하기 쉽다. 하지만 하이드레이션 작업을 하는 초기 렌더링 때 적용되기 때문에, 해당 스크립트가 실행되고 적용되기 까지 일부 요소가 깜빡이는 현상이 발생할 수 있다. 추가적인 SSR 설정을 통해서 해당 문제를 해결할 수도 있다.
