# 민지

## 4.1 서버 사이드 렌더링이란?

### 4.1.1 배경

- 서버 사이드 렌더링 애플리케이션과 싱글 페이지 애플리케이션
  - **싱글 페이지 애플리케이션(SPA)**
    1. **등장 배경**
       - 전통적 방식의 애플리케이션
         - 페이지를 요청하면 서버에서 완성된 HTML을 내려 받고, 페이지 이동 시마다 새로운 페이지를 서버에서 내려받는 방식
         - 단점: 페이지 전환 시 페이지를 처음부터 새로 그려야 해서 부자연스러운 모습
       - 싱글 페이지 애플리케이션의 등장
         - **페이지 전환 시 자바스크립트로 처리**하면 추가 리소스(HTML)를 다운로드하는 시간이 필요 없고, **페이지 전환에 필요한 일부 영역만 다시 그리므로 매끄러운 UI** 보여줌
         - `JAM(JavaScript, API, Markup)` 스택
           - 자바스크립트가 다양한 작업을 수행하면서 자바스크립트 모듈화, 사용자 기기 성능 향상, 인터넷 속도 발전 등으로 자바스크립트에서 할 수 있는 일이 다양해졌음
           - 프레임워크의 등장으로 JAM 스택이 등장. **자바스크립트와 마크업(HTML, CSS)을 미리 빌드해 두고 정적으로 사용자에게 제공**
           - 자바스크립트를 활용한 다양한 라이브러리와 툴들로 정적인 프론트엔드 마크업 페이지들을 미리 생성하여 `**pre-rendering**`하고, 로그인/결제/댓글과 같은 기능들은 외부 API 서비스로 아웃소싱해 설계를 분리 → `**decoupling**`
           - **빌드 및 배포를 자동화하고, 정적 페이지를 CDN으로 배포**해 비용 절감, 사용자 경험 개선, 보안 확장, 사이트 성능 향상, 개발 용이
         - `MEAN`, `MERN` 스택
           - API 서버 자체도 자바스크립트로 구현하는 구조
    2. **개념**
       - 첫 페이지는 모든 데이터 불러와 **빈 HTML에 자바스크립트 코드로 `<body />` 내용을 넣어 렌더링**
       - 페이지 전환 시 `history.pushState`와 `history.replaceState`를 사용해 **하나의 페이지에서 모든 작업을 처리**하고, **다음 페이지 렌더링에 필요한 정보만 요청해 DOM을 추가, 수정, 삭제**
    3. 장단점
       - 장점: 로딩 이후에는 서버를 거쳐 리소스를 받아 올 일이 적어져 사용자에게 훌륭한 UI/UX를 제공
       - 단점: 최초에 로딩해야 할 자바스크립트 리소스가 커진다.

### 4.1.2 서버 사이드 렌더링이란?

- **서버 사이드 렌더링 애플리케이션**

1. **등장 배경**
   - 자바스크립트 리소스의 크기와 수가 증가
   - 사용자의 기기와 인터넷 속도 등 환경이 크게 개선됐지만 실제 사용자들이 느끼는 웹 애플리케이션의 로딩 속도는 5년 전과 같거나 더 느리다.
2. **개념**
   - **최초에 보여줄 페이지를 서버에서 렌더링**해 **빠르게 사용자 화면을 제공**
   - 싱글 페이지 애플리케이션과 서버 사이드 렌더링의 차이: **웹페이지 렌더링의 책임**
     - SPA: 자바스크립트 번들에서 렌더링 → 사용자 기기의 성능에 영향을 받음
     - SSR: 서버에서 렌더링 → 비교적 안정적인 렌더링
3. 장단점
   - 장점
     1. 최초 페이지 진입이 비교적 빠르다
     2. 검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다
     3. 누적 레이아웃 이동이 적다
     4. 사용자 디바이스 성능에 비교적 자유롭다
     5. 보안에 좀 더 안전하다
   - 단점
     1. 소스코드를 작성할 때 항상 서버를 고려해야 한다
     2. 적절한 서버가 구축돼 있어야 한다
     3. 서비스 지연에 따른 문제

### 4.1.3 SPA와 SSR을 모두 알아야 하는 이유

- 서버 사이드 렌더링도 만능이 아니다
  - 웹페이지에서 사용자게에 제공하고 싶은 내용이 무엇인지, 어떤 우선순위에 따라 페이지의 내용을 보여줄지를 잘 설계하는 것이 중요하다.
- SPA와 SSR
  - 가장 뛰어난 SPA는 가장 뛰어날 MPA보다 낫다.
  - 평균적인 SPA는 평균적 MPA보다 느리다. 별도의 최적화를 거쳐야 하는 SPA보다 서버에서 렌더링되는 MPA가 더 나은 경험을 제공할 수 있다.
  - 두 가지 모두 장단점이 있으며 유요한 방법이다.
- 현대의 서버 사이드 렌더링(Next, Remix 등)
  - 최초 웹사이트 진입 시에는 서버 사이드 렌더링 방식으로 서버에서 완성된 HTML을 제공받고,
  - 이후 라우팅은 서버에서 내려받은 자바스크립트를 바탕으로 SPA처럼 작동

## 4.2 서버 사이드 렌더링을 위한 리액트 API

- reac-dom/server.js에서 제공하며, Node.js와 같은 서버 환경에서 실행할 수 있다.

### 4.2.1 renderToString

```tsx
const result = ReactDOMserver.renderToString(React.createElement("div", { id: "root" }, <SampleComponent />));
```

- 인수로 넘겨받은 리액트 컴포넌트를 렌더링해 HTML 문자열로 반환하는 함수
- 최초 HTML 페이지를 빠르게 그려주는 목적
- 클라이언트에서 실행되는 자바스크립트 코드는 별도로 다운로드, 파싱, 실행하는 과정을 거쳐야 한다.
- data-reactroot 속성으로 hydrate 함수에서 리액트 컴포넌트의 루트 엘리먼트를 식별

### 4.2.2 renderToStaticMarkup

```tsx
const result = ReactDOMServer.renderToStaticMarkup(React.createElement("div", { id: "root" }, <SampleComponent />));
```

- renderToString처럼 리액트 컴포넌트를 기준으로 HTML 문자열을 만든다는 점에서 동일하다.
- 차이점은 루트 요소에 추가한 data-reactroot와 같은 리액트에서만 사용하는 추가적인 DOM 속성을 만들지 않는다. 따라서 클라이언트에서 리액트에서 제공하는 useEffect와 같은 브라우저 API를 실행할 수 없다.
- 즉, hydrate를 수행하지 않는다는 가정 하에 순수한 HTML만 반환. 리액트의 이벤트 리스너가 필요 없는 완전히 순수한 HTML을 만들 때 사용
- 결과물인 HTML의 크기를 아주 약간이라도 줄일 수 있다.

### 4.2.3 renderToNodeStream

- 브라우저에서 사용할 수 없으며, 결과물의 타입이 ReadableSteram
- 스트림을 활용하면 큰 크기의 데이터를 청크 단위로 분리해 순차적으로 처리할 수 있다는 장점

### 4.2.4 renderToStaticNodeStream

- 리액트 자바스크립트에 필요한 리액트 속성이 제공되지 않으며, 마찬가지로 hydrate를 할 필요가 없는 순수 HTML 결과물이 필요할 때 사용하는 메서드

### 4.2.5 hydrate

- renderTostring과 RenderToNodeStream으로 생성된 HTML의 콘텐츠에 자바스크립트 핸들러나 이벤트를 붙이는 역할
- 정적으로 생성된 HTML에 이벤트와 핸들러를 붙여 완전한 웹페이지 결과물을 만든다.
