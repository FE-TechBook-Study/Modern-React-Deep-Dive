# 민지

- 자바스크립트 메모리, 네트워크, 소스, 실제 HTML 및 CSS 등 리액트가 아닌 일반적인 웹 애플리케이션 환경의 디버깅을 수행
- 각종 확장 프로그램이 실행되지 않도록 순수하게 웹페이지와 관련된 정보만 볼 수 있도록 시크릿 모드에서 여는 것을 권장

## 7.2 요소 탭

- 현재 웹 페이지를 구성하고 있는 HTML, CSS 등의 정보 확인

### 7.2.1 요소 화면

- 디버깅 요소를 클릭하고 중단 위치를 선택하면 브라우저가 렌더링을 중단하고 해당 요소 변경을 일으킨 소스코드를 보여준다.

## 7.3 소스 탭

- 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일 확인
- 소스 중단점을 생성해 자바스크립트 실행을 중단시키고 디버깅 가능.
- **변수의 값을 미리 보여주는 기능**, **감시에 변수를 추가해 실제 변숫값을 확인**하는 기능을 사용하면 변수마다 console.log로 디버깅하지 않아도 빠르게 확인 가능

## 7.4 네트워크 탭

- 웹페이지가 외부 데이터와 통신하는 정보를 확인
- 확인해 볼 점
  - **불필요한 요청, 중복 요청 없는지**
  - **리소스 크기가 너무 크지 않은지**
  - **리소스를 불러오는 속도**가 적절한지
  - 리소스가 **올바른 우선순위로 다운로드**되어 페이지가 자연스럽게 만들어지는지
- 스크린샷 캡처 기능으로 네트워크 요청 흐름에 따라 웹페이지가 어떻게 로딩되고 있는지 확인
- 노출되는 영역이 큰 중요한 콘텐츠가 우선적으로 다운로드되고, 배경 이미지처럼 우선순위가 비교적 낮은 경우 나중에 다운로드 돼야 함
- 리소스 크기가 너무 크다면 gzip, brotli 등을 이용해 리소스를 압축하거나 이미지 최적화

## 7.5 메모리 탭

- 현재 웹페이지가 차지하고 있는 메모리 관련 정보를 확인
- 메모리 누수, 속도 저하, 웹페이지 프리징 현상을 확인
- 프로파일링 유형
  - 힙 스냅샷: 현재 시점의 메모리 상황
  - 타임라인의 할당 계측: 시간의 흐름에 따른 메모리 변화. 로딩 과정의 메모리 변화, 상호작용 시 메모리 변화 확인을 위해 주로 사용.
  - 할당 샘플링: 메모리 공간을 차지하고 있는 자바스크립트 함수

### 7.5.2 힙 스냅샷

- 현재 페이지의 메모리 상태를 확인
- 전후 스냅샷을 찍어 얕은 크기 항목을 기준으로 내림차순해 비교 → **어떤 변수가 메모리를 크게 잡아먹고 있는지 확인**
- 메모리 누수가 의심 되는 지점의 전후 스냅샷 간 어떤 인터랙션으로 메모리 사용량 차이가 발생했는지 확인 가능

- 얕은 크기와 유지된 크기?
  - **얕은 크기**: 객체 자체가 보유하는 메모리 바이트의 크기
  - **유지된 크기**: 해당 객체 자체뿐만 아니라 다른 부모가 존재하지 않는 모든 자식 객체들의 크기까지 더한 값
  - **메모리 누수**를 찾을 때는 **얕은 크기(객체 자체의 크기)는 작지만 유지된 크기(객체가 참조하고 있는 모든 객체들의 크기)가 큰 객체**를 찾아야 한다.
  - 두 크기의 차이가 큰 객체는 **다수의 다른 객체를 참조하고 있다**는 뜻이며, **해당 객체가 복잡한 참조 관계를 가지고 있다**는 뜻

### 7.5.3 타임라인 할당 계측

- 시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능
- 메모리 변화를 일으킨 변수, 해당 변수가 차지하는 크기
- 많은 부담 발생

### 7.5.4 할당 샘플링

- 시간의 흐름에 따라 발생하는 메모리 점유를 확인
- **자바스크립트 실행 스택별로 분석**할 수 있고, 분석을 **함수 단위**로 한다.
- 할당 프로파일링이 끝나고 무거움 순으로 정렬하면 가장 무거운 변수와 이 변수가 무엇 때문에 할당됐는지 구체적으로 알 수 있다.
- 브라우저에 주는 부담을 최소화할 수 있어 장시간에 걸쳐 디버깅 해야 할 때 유리
- 따라서 메모리 누수가 정확히 어디에서 발생했는지 확인이 어려운 경우 사용

### 7.6.1 Next.js 프로젝트 디버그 모드로 실행하기

- Next.js 프로젝트 디버그 모드로 실행
  ```jsx
  "dev": NODE_OPTIONS='--inspect' next dev
  ```
- chrome://inspect에서 Open dedicated DevTools for Node

### 7.6.2 Next.js 서버에 트래픽 유입시키기

- 서버에서 제공되는 서비스는 서버를 실행한 뒤 사용자가 유입되면서 메모리 누수가 발생하는 경우가 많다.
- ab: 아파치 재단에서 제공하는 웹서버 성능 검사 도구로, HTTP 서버의 성능을 벤치마킹할 수 있는 도구
  ```jsx
  ab -k -c -n 10000 "http://127.0.0.1:3000/"
  ```
  - 한 번에 50개의 요청을 총 10000회 실행
  - 반드시 올바른 주소 기재 (localhost로 실행하면 X)

### 7.6.3 Nect.js의 메모리 누수 지점 확인하기

- 해당 페이지에 사용자가 방문할 때마다 메모리 사용이 점차 늘어나는 지점을 확인
