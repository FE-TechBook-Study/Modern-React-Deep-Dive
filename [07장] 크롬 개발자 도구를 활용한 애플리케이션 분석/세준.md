# 세준

# 7장 크롬 개발자 도구

시크릿 모드에서 개발자 도구를 여는 것을 권장한다.

- 브라우저의 확장 프로그램이 실행되지 않아 디버깅 시에 불필요한 정보를 제외시킬 수 있다.

## 메모리 탭

- **힙 스냅샷**
  - 현재 메모리 상황을 사진 찍듯이 촬영할 수 있다.
- **타임라인 할당 계측**
  - 시간에 흐름에 따라 메모리의 변화를 보여준다. 주로 로딩이 되는 과정의 메모리 변화 또는 페이지의 상호작용에 따른 메모리의 변화과정을 볼 때 사용된다.
- **할당 샘플링**
  - 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

### 1. 자바스크립트 인스턴스 VM 선택

현재 실행 중인 자바스크립트 VM 인스턴스를 확인할 수 있다. 개발자가 디버깅하고 싶은 자바스크립트 VM 환경을 선택하면된다. 환경별 힙 크기를 보여주며 해당 페이지가 힙을 얼마나 점유하고 있는 지 나타낸다. 이 크기는 자바스크립트 실행에 따라 실시간으로 변경된다.

### 2. 힙 스냅샷

현재 페이지의 메모리 상태를 확인해 볼 수 있는 도구다. 촬영하는 시점을 기준으로 메모리 현황을 보여준다.

각 스냅샷 별로 메모리 크기에 대한 비교를 할 수 있다. 어느 함수를 통해 메모리를 크게 차지 했는지, 해당 객체가 어떠한 값을 가지고 있는 지 등을 확인할 수 있다.

> **얕은 크기와 유지된 크기의 차이점**

- 얕은 크기란 객체 자체가 보유하는 메모리 바이트의 크기를 나타낸다.
- 유지된 크기란 해당 객체뿐만 아니라 다른 부모가 존재하지 않는 모든 자식 객체들의 크기까지 더한 값이다.

```tsx
var counter = 0;
var instances = [];

function Y(){
	this.j = 5;
}

function X() {
	this.i = counter++;
	this.y = new Y();
}

export default functin App(){
	function handleClick() {
		instances.push(new X());
	}

	return <button onClick={handleClick}>+</button>
}
```

이 코드는 버튼 클릭 시 `X`라는 새로운 객체를 생성하는데 생성자 내부에서 `Y`라는 새로운 생성자를 생성해 할당한다.

스냅샷을 통해 봤을 때 X의 유지된 크기는 100, 얕은 크기는 52. Y의 유지된 크기는 48, 얕은 크기는 48인 것을 확인해 볼 수 있다. 즉 X의 유지된 크기는 Y의 유지된 크기를 더한 값이다.

`메모리 누수를 찾을 때는 얕은 크기는 작으나 유지된 크기가 큰 객체를 찾아야 한다.`

이는 해당 객체가 복잡한 참조 관계를 가지고 있다는 의미다.

이 스냅샷을 활용하면 useMemo나 useCallback과 같은 의존성이 있는 값들이 정말로 렌더링 사이에 그대로 유지되는지 확인할 수 있다.

## 타임라인 할당 계측

시간 흐름에 따라 메모리의 변화를 모두 기록하여 보여준다. 원하는 범위로 기간을 좁혀 확인할 수 있고 `전역 변수로 저장`을 눌러 해당 변수가 어떠한 값을 가지고 있는지 확인할 수 있다.

## 할당 샘플링

시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다는 점에서 할당 계측과 비슷하지만 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 점에서 차이가 있다.

무거운 순으로 정렬하면 가장 많은 바이트를 차지한 함수의 작업이 맨 위로 올라오고 여기서 문제가 되는 함수를 확인할 수 있다. 오른쪽 파일명을 누르거나 오른쪽 마우스 버튼 클릭하여 `소스 패널에 표시` 를 선택해 해당 함수가 어느 파일에서 어떻게 정의 되었는 지도 확인 가능하다.
