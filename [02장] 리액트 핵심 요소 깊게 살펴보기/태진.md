# 태진

# 2. 가상 DOM과 리액트 파이버

### 1. DOM과 브라우저 렌더링 과정

- 브라우저 통신 과정

  1. 도메인 주소를 입력하면 DNS를 통해 IP 주소를 브라우저에게 전달한다.
  2. 만약 입력한 도메인 주소가 캐싱된 DNS 기록에 존재한다면 DNS서버에 IP주소를 요청하지 않고 캐싱된 IP주소를 사용한다.
  3. 브라우저는 전달받은 IP 주소를 TCP/IP 프로토콜을 사용하여 GET이나 POST 등 HTTP Request을 서버에 보낸다.
  4. 서버는 웹 서버(예: NginX, NodeJs, Apache 등)를 통해 HTTP Request을 받는다. 웹 서버는 Request Handler에게 요청을 전달하여 HTTP Response을 생성한다.
  5. 서버는 생성된 HTTP Response에 담아 브라우저에게 전달한다.
  6. 브라우저는 전달받은 HTTP Response를 가지고 렌더링을 시작한다.

- DNS(Domain Name System)은 도메인 주소와 IP주소를 서로 변환시켜주는 데이터베이스 시스템으로, 연결되어있는 도메인 주소와 IP주소가 저장된 곳이다. 우리가 브라우저 사용자 인터페이스 주소창에 도메인 이름을 입력했을 때 DNS를 통해 IP로 변환 후 서버에 전달한다.

- Request Handler는 웹 서버에서 HTTP Request를 받아 그에 맞는 Response를 생성하는 역할을 한다. 이는 주로 백엔드 프로그래밍 언어로 작성되며, 요청의 종류(GET, POST 등)나 URL 경로에 따라 다른 Handler가 호출될 수 있다.

  Request Handler는 HTTP Request에 포함된 정보를 분석하고, 필요한 데이터를 데이터베이스에서 조회하거나 다른 작업을 통해 요청을 처리한다.

  처리 결과를 바탕으로 Response를 생성하고, HTTP 프로토콜을 따르는 HTTP Response로 만든 다음 웹 서버에 전달한다. HTTP Response는 Status code, headers, body 등을 포함한다.

- 브라우저 렌더링 과정

  1. 브라우저가 서버로부터 전달받은 HTTP Response에서 HTML을 다운로드한다.
  2. 브라우저의 렌더링 엔진은 다운로드된 HTML을 파싱해 DOM 트리를 생성한다.
  3. 위 과정 중 CSS 파일을 만나면 해당 파일을 다운로드한다.
  4. 다운로드된 CSS 파일을 파싱해 CSSOM 트리를 만든다.
  5. CSSOM의 스타일 정보를 DOM에 배치하는 Attachments 과정을 통해 Render 트리가 생성된다.
  6. Render 트리는 Layout과 Painting 과정을 통해 화면에 렌더링 된다.

- Layout은 DOM 트리의 각 노드가 브라우저 화면의 어느 좌표에 나타나야 하는지 계산하는 과정이다. 이 Layout 과정을 거치면 반드시 Painting 과정도 거치게 된다.

- Painting은 Layout 단계를 거친 노드에 색깔과 같이 실제 유효한 모습을 그리는 과정이다.

- 렌더링 엔진은 더 나은 사용자 경험을 위해 HTML 파싱과 동시에 일부 요소를 렌더링 트리에 추가하고, Layout과 Painting 과정을 시작한다. 네트워크에서 나머지 내용이 전송되기를 기다림과 동시에 받은 내용의 일부를 먼저 화면에 표시한다. 하지만 전체적인 렌더링 과정은 Attachments 과정이 완료된 후 진행된다.

- 렌더링 엔진은 HTML 문서를 위에서부터 순차적으로 파싱하다가 script 태그를 만나면 해당 스크립트를 로드하고 실행하기 위해 자바스크립트 엔진에게 제어권을 넘긴다. 자바스크립트 엔진은 스크립트를 로드하고 파싱하여 실행하고, 이가 완료되면 다시 제어권을 렌더링 엔진에게 넘긴다.

  실행 된 자바스크립트 코드가 완성되지 않은 DOM을 조작하면 문제가 생길 수 있기 때문에 자바스크립트 코드는 HTML문서 하단에 위치시키는 것이 좋다. 하지만 DOM을 조작하지 않는, 페이지 초기화에 필요한 설정이 담긴 자바스크립트 코드의 경우는 head 태그 내에 위치시키는 것이 적절하다.

# 4. 렌더링은 어떻게 일어나는가?

### 2. 리액트의 렌더링이 일어나는 이유

- 사용자가 처음 애플리케이션에 진입했을 때, 리액트는 브라우저에게 브라우저 렌더링에 필요한 정보를 제공하기 위해 최초 렌더링을 진행한다.
- 함수 컴포넌트의 useState 두 번째 배열 요소인 setter가 실행되는 경우 렌더링이 진행된다.
- 함수 컴포넌트의 useReducer 두 번째 배열 요소인 dispatch가 실행되는 경우 렌더링이 진행된다.
- 배열 하위 컴포넌트 선언 때 사용되는 key가 변경되는 경우 렌더링이 진행된다.
- 부모로 전달받는 값인 props가 변경되는 경우 렌더링이 진행된다.
- 부모 컴포넌트가 렌더링이 일어날 경우 자식 커포넌트도 무조건 렌더링이 일어난다.

### 3. 리액트의 렌더링 프로세스

- 리액트의 렌더링은 렌더 단계와 커밋 단계, 두 단계로 분리되어 실행된다. 이 두 단계는 동기적으로 일어나는 것이 기본값이다.
- 렌더 단계는 컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업을 말한다.
- 커밋 단계는 렌더 단계의 변경 사항을 실제 DOM에 적용해 사용자에게 보여주는 작업을 말한다. DOM이 커밋 단계에서 업데이트 되면 DOM 노드 및 인스턴스에 대해 리액트 내부 참조를 업데이트하고 useLayoutEffect를 호출한다.
- 리액트의 렌더링이 일어났다고 해서 무조건 DOM이 업데이트 되는 것은 아니다. 렌더 단계를 진행했는데 아무 변경 사항이 감지되지 않는다면 커밋 단계는 생략될 수 있다. 즉, 가시적인 변경이 일어나지 않아도 리액트의 렌더링은 일어날 수 있다는 이야기다.
